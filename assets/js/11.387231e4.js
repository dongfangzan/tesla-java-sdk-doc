(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{282:function(t,s,a){"use strict";a.r(s);var e=a(13),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"认证-authentication-v3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#认证-authentication-v3"}},[t._v("#")]),t._v(" 认证 Authentication V3")]),t._v(" "),s("p",[t._v("目前网上能找到的特斯拉认证接口大多数是基于V2版本的，而且特斯拉已经封了该接口，导致大量认证程序无法正常登录，包括https://tesla-api.timdorr.com/文中写的内容也不再适用于与当前版本。")]),t._v(" "),s("p",[t._v("本文主要基于V3版本的认证接口对该部分文档进行了重写，并提供了一键"),s("RouterLink",{attrs:{to:"/basics/auth_tool.html"}},[t._v("认证工具")]),t._v("。")],1),t._v(" "),s("p",[t._v("特斯拉基于OAuth2.0搭建了一个认证中心用于单点登录，在认证通过后会返回一个access token和一个refresh token。access token的有效期为8小时，过期后可以使用refresh token去刷新access token的有效期。原则上来说，只要不修改密码，就可以一直使用refresh token来获取特斯拉的访问权限。")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("关于OAuth")]),t._v(" "),s("p",[t._v("首先大家需要理解OAuth2.0协议到底是干什么的，这里我就不多科普，感兴趣的同学可以看一下阮一峰的博客，详细解释了"),s("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("OAuth协议"),s("OutboundLink")],1),t._v("，而且特斯拉就使用了文中的第一种，授权码方式。")])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("需要注意的是，特斯拉的SSO有WAF，所以如果你反复的一直去刷特斯拉的接口，就会跳出一个风控挑战的页面，来让你证明自己不是机器人。所以尽量不要高频率的刷新特斯拉的认证接口，以防给自己带来不必要的麻烦。")])]),t._v(" "),s("h2",{attrs:{id:"登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[t._v("#")]),t._v(" 登录")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("简化版本")]),t._v(" "),s("p",[t._v("以下内容涉及特斯拉V3版本OAuth流程原理，可能内容较长，你也可以查看"),s("RouterLink",{attrs:{to:"/basics/auth_tool.html"}},[t._v("认证工具")]),t._v("中提供的小工具来快速完成通过账号密码获取token的全部流程")],1)]),t._v(" "),s("h3",{attrs:{id:"第一步-访问登录页"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一步-访问登录页"}},[t._v("#")]),t._v(" 第一步：访问登录页")]),t._v(" "),s("h4",{attrs:{id:"get-https-auth-tesla-cn-oauth2-v3-authorize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get-https-auth-tesla-cn-oauth2-v3-authorize"}},[t._v("#")]),t._v(" GET https://auth.tesla.cn/oauth2/v3/authorize")]),t._v(" "),s("p",[t._v("为了获取特斯拉的access token，我们需要一个入口登录我们的特斯拉账号。为了保障信息安全，我们应该使用特斯拉的页面来获取token，防止用户名密码的泄露。那么首先我们就需要去请求并在浏览器（pc端、移动端均可）渲染一个特斯拉登录页面。")]),t._v(" "),s("h4",{attrs:{id:"例子-你可以直接点击链接-就会看到下面的登录页面"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#例子-你可以直接点击链接-就会看到下面的登录页面"}},[t._v("#")]),t._v(" 例子，你可以直接点击"),s("a",{attrs:{href:"https://auth.tesla.cn/oauth2/v3/authorize?client_id=ownerapi&redirect_uri=https://auth.tesla.com/void/callback&response_type=code&scope=openid%20email%20offline_access&state=v9ICSc2Ld6g2m5rdDwwH&code_challenge=NTA3NzE5NzFlZDljNWExODMzMjFlYTJmNmRjNDNlMzMzMzBhYmM4NTgyZDhjNjAzZTRlOGIxOWUxOTc2MGYwYQ&code_challenge_method=S256",target:"_blank"}},[t._v("链接")]),t._v("，就会看到下面的登录页面")]),t._v(" "),s("img",{attrs:{src:t.$withBase("/images/tesla-sso.png"),alt:"cover"}}),t._v(" "),s("p",[t._v("你也可以将下面的地址复制到浏览器中，并尝试访问，两种方式的效果是一样的")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("如果是海外的地址可以把auth.tesla.cn换成auth.tesla.com\nhttps://auth.tesla.cn/oauth2/v3/authorize?client_id=ownerapi&redirect_uri=https://auth.tesla.com/void/callback&response_type=code&scope=openid%20email%20offline_access&state=v9ICSc2Ld6g2m5rdDwwH&code_challenge=NTA3NzE5NzFlZDljNWExODMzMjFlYTJmNmRjNDNlMzMzMzBhYmM4NTgyZDhjNjAzZTRlOGIxOWUxOTc2MGYwYQ&code_challenge_method=S256\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("下面我们逐一解释地址中涉及到的参数")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("例子")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("client_id")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("ownerapi")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v('OAuth Client Id，通常直接填写"ownerapi"')])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("code_challenge")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("通过下述代码生成")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("用于认证过程中获取code和交换token")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("code_challenge_method")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("S256")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v('生成code challenge的方法，这里直接写"S256"')])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("redirect_uri")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("https://auth.tesla.com/void/callback")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("这里是一个固定地址")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("response_type")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("code")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v('oauth的响应类型，这里固定写"code"')])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("scope")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("openid email offline_access")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("这里也是固定值")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("state")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("123")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("你可以自己随机一个字符串，在认证完成后特斯拉会返回这个字符串供你进行校验")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("login_hint")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,非必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("elon_musk@tesla.com")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("用来认证的特斯拉账号")])])])]),t._v(" "),s("p",[t._v("其中关键的参数为"),s("code",[t._v("code verifier")]),t._v("和"),s("code",[t._v("code challenge")]),t._v("。"),s("code",[t._v("code verifier")]),t._v("是一个长度为86的随机字符串，"),s("code",[t._v("code challenge")]),t._v("是对"),s("code",[t._v("code verifier")]),t._v("用SHA256进行哈希后再用url safe base64进行编码后生成的字符串，Java代码如下")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("注意，这里的base64是url safe base64，不是普通的base64，如果你用错了，那就会出点小问题。因为普通的base64通常会包含"),s("code",[t._v("=")]),t._v("，我们这些参数是要GET请求的查询参数，拼接在URL上面，所以要使用url safe base64。")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 根据code verifier获取code challenge，本方法使用commons-codec包\n *\n * @param codeVerifier code verifier\n * @return code challenge\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCodeChallenge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" codeVerifier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringUtils")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isBlank")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codeVerifier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IllegalArgumentException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code verifier 不能为空"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CODE_VERIFIER_LENGTH")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" codeVerifier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("length")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IllegalArgumentException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"code verifier的长度应为86"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageDigest")]),t._v(" messageDigest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" codeChallenge "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        messageDigest "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageDigest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SHA-256"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" hash "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" messageDigest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("digest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("codeVerifier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StandardCharsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UTF_8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" sha256 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Hex")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeHexString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        codeChallenge "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Base64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encodeBase64URLSafeString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sha256"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StandardCharsets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UTF_8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("NoSuchAlgorithmException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" codeChallenge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br")])]),s("p",[t._v("这里我也给一对"),s("code",[t._v("code verifier")]),t._v("和"),s("code",[t._v("code challenge")]),t._v("的例子，如果你想用其他语言来实现的话，可以拿这个验证一下你的代码写对了没有。")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("code verifier:\naklTa0pFQmludXh5dHJ2aE9wZW5HQ2ZyYU1uS3NsamVNVEdJWkNTYkZCWklkdU5rbXdYbGdDcmdUVWlxREF4Sg\n\ncode challenge:\nNTA3NzE5NzFlZDljNWExODMzMjFlYTJmNmRjNDNlMzMzMzBhYmM4NTgyZDhjNjAzZTRlOGIxOWUxOTc2MGYwYQ\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("在渲染的特斯拉登录页面中可以看到一个form表单，里面包含了一个隐藏的input，来防御CSRF。同时这里还包含了"),s("code",[t._v("_csrf")]),t._v(","),s("code",[t._v("_phase")]),t._v(","),s("code",[t._v("_process")]),t._v(","),s("code",[t._v("transaction_id")]),t._v(","),s("code",[t._v("cancel")]),t._v("标签，这些标签中的值可能会根据特斯拉服务端进行变化，并在认证过程中需要带在POST请求的请求体中。")]),t._v(" "),s("p",[t._v("从原理上讲，我们就需要爬取特斯拉页面中的各类input标签，然后将上述四个标签的值和你的账号密码通过POST请求向认证服务器发起请求进行认证。\n"),s("img",{attrs:{src:t.$withBase("/images/login-form.png"),alt:"cover"}})]),t._v(" "),s("h3",{attrs:{id:"第二步-获取认证code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二步-获取认证code"}},[t._v("#")]),t._v(" 第二步，获取认证code")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("目前你在各大网站上找到的tesla认证接口获取token的方式，可能都已经过时从而无法获取token。这里会基于特斯拉v3版本的oauth流程进行详解，会与之前的版本有所不同。")])]),t._v(" "),s("p",[t._v("特斯拉v3版本的oauth流程，将账号密码的认证过程分成两步，分别是认证账号，和认证密码，我们分开来讲。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-认证账号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-认证账号"}},[t._v("#")]),t._v(" 2.1 认证账号")]),t._v(" "),s("p",[t._v("从上述构建好的登录链接可以看到，我们跳转到了一个只有电子邮箱的登录页面。在这个页面中，我们打开检查，会看到页面中包含到的上述CSRF相关内容，我们需要把其中的"),s("code",[t._v("_csrf")]),t._v(","),s("code",[t._v("_phase")]),t._v(","),s("code",[t._v("transaction_id")]),t._v("中的值取出来构建一个请求。")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("点击查看图片")]),t._v(" "),s("p",[s("img",{attrs:{src:t.$withBase("/images/tesla-sso.png"),alt:"cover"}}),s("img",{attrs:{src:t.$withBase("/images/login-form.png"),alt:"cover"}})])]),t._v(" "),s("h4",{attrs:{id:"post-https-auth-tesla-cn-oauth2-v3-authorize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#post-https-auth-tesla-cn-oauth2-v3-authorize"}},[t._v("#")]),t._v(" POST "),s("code",[t._v("https://auth.tesla.cn/oauth2/v3/authorize")])]),t._v(" "),s("h4",{attrs:{id:"参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("例子")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("_csrf")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("w2VzzI2I-....")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在表单页中取出")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("_phase")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("identity")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("固定值"),s("code",[t._v("identity")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("transaction_id")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("TBrNJZwZ")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("表单也中取出，本次会话id")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("cancel")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("``")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("固定值")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("identity")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("elon_musk@tesla.com")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("你的账号")])])])]),t._v(" "),s("h4",{attrs:{id:"request-body"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-body"}},[t._v("#")]),t._v(" Request Body")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_csrf"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w2VzzI2I-...."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_phase"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"identity"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"transaction_id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TBrNJZwZ"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cancel"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"identity"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elon_musk@tesla.com"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("如果认证通过，页面会刷新，你就会得到一个新的页面，并且这个页面中已经填写好上一步你填写的那个邮箱地址，并出现了密码输入框。\n"),s("img",{attrs:{src:t.$withBase("/images/elon_musk.png"),alt:"cover"}})]),t._v(" "),s("h3",{attrs:{id:"_2-2-认证密码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-认证密码"}},[t._v("#")]),t._v(" 2.2 认证密码")]),t._v(" "),s("p",[t._v("到这里，如果你打开检查页面，并查看页面代码时，你会发现form表单发生了更新，出现了新的"),s("code",[t._v("_csrf")]),t._v(","),s("code",[t._v("_phase")]),t._v(","),s("code",[t._v("transaction_id")]),t._v("。\n"),s("img",{attrs:{src:t.$withBase("/images/new-login-form.png"),alt:"cover"}})]),t._v(" "),s("p",[t._v("现在我们需要做的和认证账号的内容其实类似，构建一个新的请求，不过这次把密码带上。")]),t._v(" "),s("h4",{attrs:{id:"post-https-auth-tesla-cn-oauth2-v3-authorize-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#post-https-auth-tesla-cn-oauth2-v3-authorize-2"}},[t._v("#")]),t._v(" POST "),s("code",[t._v("https://auth.tesla.cn/oauth2/v3/authorize")])]),t._v(" "),s("h4",{attrs:{id:"参数说明-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-2"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("例子")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("_csrf")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("w2VzzI2I-....")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在表单页中取出")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("_phase")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("authenticate")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("固定值"),s("code",[t._v("authenticate")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("transaction_id")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("TBrNJZwZ")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("表单也中取出，本次会话id")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("cancel")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("``")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("固定值")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("identity")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("elon_musk@tesla.com")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("你的账号")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("privacy_consent")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("1")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("固定值"),s("code",[t._v("1")]),t._v("，表示你同意Tesla的客户隐私声明和使用条款")])])])]),t._v(" "),s("h4",{attrs:{id:"request-body-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-body-2"}},[t._v("#")]),t._v(" Request Body")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_csrf"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w2VzzI2I-...."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_phase"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authenticate"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"transaction_id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TBrNJZwZ"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cancel"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"identity"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elon_musk@tesla.com"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"credential"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"password"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"privacy_consent"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("h3",{attrs:{id:"_2-3-获取认证code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-获取认证code"}},[t._v("#")]),t._v(" 2.3 获取认证code")]),t._v(" "),s("p",[t._v("在页面完成特斯拉输入账号密码，并完成认证登录后。上述页面会重定向到一个地址，并带上oauth返回的认证code，我们就可以用这个code来换取token了。\n这个地址类似：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("https://auth.tesla.com/void/callback?code=c7dc7f8196d001632558d6632558d6243632558d6b6d60f82c0632558d67&state=v9ICSc2Ld6g2m5rdDwwH&issuer=https%3A%2F%2Fauth.tesla.cn%2Foauth2%2Fv3\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("img",{attrs:{src:t.$withBase("/images/auth-code.png"),alt:"cover"}}),t._v(" "),s("h4",{attrs:{id:"参数说明-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-3"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("例子")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("code")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("认证通过返回的code，你可以使用这个code来换取access token")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("c7dc7f8196d001632558d663255..")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("state")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("构建登录页面时随机的字符串，可以用来验证响应是否被篡改/或者是否是本次请求")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("v9ICSc2Ld6g2m5rdDwwH")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("issuer")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("这个参数对我们来说不重要")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("https://auth.tesla.cn/oauth2/v3")])])])])]),t._v(" "),s("h3",{attrs:{id:"第三步-使用code来交换access-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三步-使用code来交换access-token"}},[t._v("#")]),t._v(" 第三步，使用code来交换access token")]),t._v(" "),s("h4",{attrs:{id:"post-https-auth-tesla-cn-oauth2-v3-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#post-https-auth-tesla-cn-oauth2-v3-token"}},[t._v("#")]),t._v(" POST "),s("code",[t._v("https://auth.tesla.cn/oauth2/v3/token")])]),t._v(" "),s("p",[t._v("使用上一步获得到的code，调用本接口，就可以获取到最终的access token和refresh token了")]),t._v(" "),s("h4",{attrs:{id:"参数说明-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-4"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("例子")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("client_id")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ownerapi")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v('OAuth Client Id，通常直接填写"ownerapi"')])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("grant_type")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("authorization_code")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("授权类型，这里直接写"),s("code",[t._v("authorization_code")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("code")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("c7dc7f8196d001632558d663255..")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在上一步骤中获取到的code")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("redirect_uri")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("https://auth.tesla.com/void/callback")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("这里是一个固定地址")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("code_verifier")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("aklTa0pFQmludXh5dHJ2")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在第一步中你构建登录请求时创建的随机字符串")])])])]),t._v(" "),s("h4",{attrs:{id:"request-body-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-body-3"}},[t._v("#")]),t._v(" request body")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grant_type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"authorization_code"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"client_id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ownerapi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4ee34c0f5d98339781bd224394860b093919b8fbde09f759a2ef832900a6"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"code_verifier"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aklTa0pFQmludXh5dHJ2aE9wZW5HQ2ZyYU1uS3NsamVNVEdJWkNTYkZCWklkdU5rbXdYbGdDcmdUVWlxREF4Sg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"redirect_uri"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://auth.tesla.com/void/callback"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("h4",{attrs:{id:"response-body"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#response-body"}},[t._v("#")]),t._v(" response body")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"access_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJacess"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJrefresh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJid"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expires_in"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("28800")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"state"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v9ICSc2Ld6g2m5rdDwwH"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"token_type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bearer"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("h2",{attrs:{id:"构建请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建请求"}},[t._v("#")]),t._v(" 构建请求")]),t._v(" "),s("p",[t._v("有了access token之后，可能不少有经验的同学就会发现这个token十分眼熟，没错，这就是一个普通的JwtToken，如果你有过类似使用该token的经验，那么很快就可以猜出来如何使用这个token了。")]),t._v(" "),s("p",[t._v("很简单，就是在后续每一个需要认证后才能使用的接口（如查询车辆信息）请求的header中加入")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Authorization: Bearer {access_token}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"刷新access-token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#刷新access-token"}},[t._v("#")]),t._v(" 刷新access token")]),t._v(" "),s("p",[t._v("通常来说access token都是有过期时间，但如果access token过期了，我们调用某些接口特斯拉就会返回")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"invalid bearer token"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("这时如果我们想继续获取访问权限，就需要获取新的access token，我们可以用本接口来刷新access token。")]),t._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[t._v("DANGER")]),t._v(" "),s("p",[t._v("原则上来说，如果我们保留着refresh token，就可以一直通过刷新access token来获取特斯拉的访问权限。\n换句话说，市面上有不少第三方工具，可能已经获取了你的refresh token，那么如果他想搞你的车，那么你懂的👻👻👻")])]),t._v(" "),s("h4",{attrs:{id:"post-https-auth-tesla-cn-oauth2-v3-token-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#post-https-auth-tesla-cn-oauth2-v3-token-2"}},[t._v("#")]),t._v(" POST https://auth.tesla.cn/oauth2/v3/token")]),t._v(" "),s("h4",{attrs:{id:"参数说明-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参数说明-5"}},[t._v("#")]),t._v(" 参数说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("例子")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("client_id")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ownerapi")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("OAuth Client Id，通常直接填写"),s("code",[t._v("ownerapi")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("grant_type")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("refresh_token")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("授权类型，这里直接写"),s("code",[t._v("refresh_token")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("refresh_token")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("eyJrefresh")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在上一步骤中获取到的refresh token")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("scope")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String,必填")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("openid email offline_access")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("固定值")])])])]),t._v(" "),s("h4",{attrs:{id:"request-body-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request-body-4"}},[t._v("#")]),t._v(" request body")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"grant_type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"client_id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ownerapi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJrefresh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scope"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"openid email offline_access"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h4",{attrs:{id:"response-body-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#response-body-2"}},[t._v("#")]),t._v(" response body")]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"access_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJaccess"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"refresh_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eyJrefresh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id_token"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expires_in"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"token_type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bearer"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("至此，我们就完成关于特斯拉认证接口的全部内容，后续的所有操作，都是基于获取该token之后的操作。")])])}),[],!1,null,null,null);s.default=n.exports}}]);